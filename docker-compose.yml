# OpenClaw Launcher - Docker Compose
# Manages sub-OpenClaw instances via Docker-in-Docker

services:
  # Deacon - manages lifecycle of sub-instances
  deacon:
    image: openclaw-launcher/deacon:latest
    build:
      context: ./deacon
      dockerfile: Dockerfile
    container_name: openclaw-deacon
    restart: unless-stopped
    dns:
      - 8.8.8.8
      - 1.1.1.1
    environment:
      - HEALTH_CHECK_INTERVAL=300
      - UPGRADE_INTERVAL=86400
      - OPENCLAW_IMAGE=openclaw-launcher/instance:latest
      - OPENCLAW_NETWORK=openclaw-launcher_openclaw-isolated
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:rw
      - deacon-data:/var/lib/deacon
    networks:
      - openclaw-isolated
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "3"

volumes:
  deacon-data:
    driver: local

networks:
  openclaw-isolated:
    driver: bridge
